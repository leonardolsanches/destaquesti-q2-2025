<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Votação - Destaques Q2 2025</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}" />
  <style>
    .card.selected {
      border: 2.5px solid #7F1734;
      box-shadow: 0 0 10px rgba(127,23,52,0.7);
    }
    .vote-count {
      font-weight: bold;
      font-size: 0.9em;
      margin-top: 8px;
      color: #7F1734;
    }
  </style>
</head>
<body>
  <header class="header">
    <img src="{{ url_for('static', filename='img/claro_logo.png') }}" alt="Claro Logo" class="logo-claro" />
    <h1>Profissionais e Líderes Indicados Q2/2025</h1>
  </header>

  {% set total_votos_profissionais = votos.profissionais.values() | sum %}
  {% set total_votos_lideres = votos.lideres.values() | sum %}

  <form method="post" action="{{ url_for('votacao') }}">
    {% if erro %}
      <p class="error">{{ erro }}</p>
    {% endif %}

    <section>
      <h2>Profissionais (selecione até 4)</h2>
      <div class="cards-container" id="profissionais-container">
        {% for prof in dados.profissionais %}
          {% set votos_prof = votos.profissionais.get(prof.id, 0) %}
          {% set perc_prof = (votos_prof / total_votos_profissionais * 100) if total_votos_profissionais > 0 else 0 %}
          <label class="card" data-id="{{ prof.id }}" data-group="profissional">
            <input type="checkbox" name="voto_profissional" value="{{ prof.id }}" class="profissional-checkbox" />
            <img src="{{ url_for('static', filename='img/' + prof.id + '.png') }}" alt="{{ prof.nome }}" />
            <div class="card-info">
              <strong>{{ prof.id }} - {{ prof.nome }}</strong>
              <p><em>Gestor: {{ prof.gestor }}</em></p>
              <p class="justificativa">{{ prof.justificativa }}</p>
              <p class="vote-count">{{ votos_prof }} votos ({{ '%.1f' % perc_prof }}%)</p>
            </div>
          </label>
        {% endfor %}
      </div>
    </section>

    <section>
      <h2>Líderes (selecione 1)</h2>
      <div class="cards-container" id="lideres-container">
        {% for lider in dados.lideres %}
          {% set votos_lider = votos.lideres.get(lider.id, 0) %}
          {% set perc_lider = (votos_lider / total_votos_lideres * 100) if total_votos_lideres > 0 else 0 %}
          <label class="card" data-id="{{ lider.id }}" data-group="lider">
            <input type="radio" name="voto_lider" value="{{ lider.id }}" required />
            <img src="{{ url_for('static', filename='img/' + lider.id + '.png') }}" alt="{{ lider.nome }}" />
            <div class="card-info">
              <strong>{{ lider.id }} - {{ lider.nome }}</strong>
              <p><em>Gestor: {{ lider.gestor }}</em></p>
              <p class="justificativa">{{ lider.justificativa }}</p>
              <p class="vote-count">{{ votos_lider }} votos ({{ '%.1f' % perc_lider }}%)</p>
            </div>
          </label>
        {% endfor %}
      </div>
    </section>

    <button type="submit" class="btn-votar">Votar</button>
  </form>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const profCheckboxes = document.querySelectorAll('.profissional-checkbox');
      profCheckboxes.forEach(cb => {
        cb.addEventListener('change', function() {
          const checked = Array.from(profCheckboxes).filter(c => c.checked);
          if (checked.length > 4) {
            this.checked = false;
            alert('Você pode selecionar até 4 profissionais.');
            return;
          }
          profCheckboxes.forEach(c => {
            if(c.checked){
              c.closest('.card').classList.add('selected');
            } else {
              c.closest('.card').classList.remove('selected');
            }
          });
        });
      });

      const liderRadios = document.querySelectorAll('input[name="voto_lider"]');
      liderRadios.forEach(radio => {
        radio.addEventListener('change', function() {
          liderRadios.forEach(r => r.closest('.card').classList.remove('selected'));
          if(this.checked) this.closest('.card').classList.add('selected');
        });
      });
    });
  </script>
</body>
</html>
